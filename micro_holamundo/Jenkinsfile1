pipeline {
    agent any
    stages {
        stage('Build') {
            steps {
                echo "Performing build"
            }
        }
        stage('Package') {
            steps {
                echo "Performing Artifact package"
            }
        }
        stage('Approval') {
            steps {
                timeout(time: 15, unit: "MINUTES") {
                    input message: 'Do you want to approve the deployment?', ok: 'Yes'
                }
            stage('Aprobación') {
            steps {
                timeout(time: 15, unit: "MINUTES") {
                    input message: '¿Deseas aprobar la implementación?', ok: 'Sí'
                }
                echo "Implementación aprobada."
                script {
                    def buildUrl = env.BUILD_URL
                    def jobName = env.JOB_NAME
                    def buildNumber = env.BUILD_NUMBER
                    def approver = env.USER
                    def emailSubject = "Aprobación requerida [Jenkins] ${jobName} #${buildNumber}"
                    def emailBody = """
                        <p>La implementación del trabajo <strong>${jobName}</strong> #${buildNumber} ha sido aprobada.</p>
                        <p>Aprobador: ${approver}</p>
                        <p>Haz clic <a href="${buildUrl}input">aquí</a> para proceder con la implementación.</p>
                    """
                    emailext mimeType: 'text/html',
                        subject: emailSubject,
                        to: "munoze297@gmail.com", // dirección de correo electrónico de destino 
                        body: emailBody
                }
            }
        }
        stage('Deployment') {
            steps {
                echo "Perform deployment"
            }
        }
    }
}

